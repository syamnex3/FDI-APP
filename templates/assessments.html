<!DOCTYPE html>
<html lang="en">
<head>
  {% load static %}
    <link rel="shortcut icon" href="{% static 'favicon.ico' %}">

<meta charset="UTF-8">
<title>Assessment Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<!-- Google Fonts (Inter) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  /* --- Global CSS Variables --- */
  :root {
    --primary-blue: #3b82f6;
    --primary-green: #22c55e;
    --header-bg: #2C3E7B;
    --container-bg: #1f223f; 
    --body-bg: #ffffff; 
    --text-dark: #111827;
    --text-light: #f9fafb;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
  }

  /* --- Base Styles --- */
  * {
    box-sizing: border-box;
  }
  html, body {
    width: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background-color: var(--body-bg);
    color: var(--text-dark);
    overflow-x: hidden;
  }

  /* --- Main Header Styles --- */
  .site-header {
    background-color: var(--header-bg);
    color: var(--text-light);
    box-shadow: var(--shadow-md);
    position: sticky;
    top: 0;
    z-index: 50;
    padding: 0.75rem 1.5rem;
  }
  .site-header-container {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    width: 100%;
  }
  .site-header-left, .site-header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .site-header-logo {
    font-weight: 600;
    font-size: 1.25rem;
  }
  .site-header-link {
    font-weight: 600;
    color: var(--text-light);
    text-decoration: none;
    transition: color 0.2s;
  }
  .site-header-link:hover {
    color: #d1d5db;
  }
  .nav-dropdown {
    position: relative;
  }
  .nav-dropdown-button {
    font-weight: 600;
    color: var(--text-light);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1rem;
    transition: color 0.2s;
  }
  .nav-dropdown-button:hover {
    color: #d1d5db;
  }
  .dropdown-menu {
    display: none;
    position: absolute;
    margin-top: 0.5rem;
    background-color: white;
    border-radius: 0.375rem;
    box-shadow: var(--shadow-xl);
    z-index: 20;
    padding: 0.25rem 0;
    color: var(--text-dark);
  }
  /* Use a class to show dropdowns on click/hover */
  .nav-dropdown.menu-open > .dropdown-menu {
    display: block;
  }
  .dropdown-menu-right {
    right: 0;
    left: auto;
  }
  .dropdown-menu-left {
    left: 0;
    right: auto;
  }
  .dropdown-menu-md { width: 12rem; }
  .dropdown-menu-lg { width: 14rem; }
  
  .dropdown-menu a, .dropdown-menu .submenu-trigger {
    display: flex;
    align-items: center;
    justify-content: flex-start; 
    gap: 0.75rem; 
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    color: var(--text-dark);
    text-decoration: none;
    white-space: nowrap;
  }
  .dropdown-menu .submenu-trigger {
    justify-content: space-between;
  }
  .dropdown-menu a:hover {
    background-color: #f3f4f6;
  }
  .submenu {
    position: relative;
  }
  .submenu-menu {
    display: none;
    position: absolute;
    left: 100%;
    top: 0;
    width: 14rem;
    z-index: 30;
  }
  .submenu:hover > .submenu-menu {
    display: block;
  }
  .profile-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #FFFFFF;
    color: #3B82F6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
  }
  .profile-icon:hover {
    background-color: #F0F0F0;
    color: #2563EB;
  }
  .profile-menu-header {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 0.25rem;
  }
  .profile-menu-header .user-name { font-weight: 600; font-size: 1rem; color: var(--text-dark); }
  .profile-menu-header .user-detail {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 180px;
  }
  .menu-divider {
    border-top: 1px solid var(--border-color);
    margin: 0.25rem 0;
  }
  .dropdown-menu-item-icon {
    width: 1.25rem;
    height: 1.25rem;
    color: var(--text-secondary);
    flex-shrink: 0;
  }
  .profile-help-icon {
    background-color: transparent;
    color: var(--text-light);
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
    transition: color 0.2s;
  }
  .profile-help-icon:hover {
    color: #d1d5db;
  }
  
  /* --- Assessments Container Styles --- */
  .assessments-container {
    background-color: var(--container-bg);
    padding: 50px 1.5rem;
    border-bottom: 1px solid var(--border-color);
    width: 100%;
  }
  .assessments-header {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 25px;
    gap: 20px;
  }
  .assessments-title {
    font-size: 28px;
    font-weight: 600;
    color: var(--text-light); 
  }
  .owner-dropdown-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
  }
  .owner-dropdown-wrapper label {
    font-weight: 500;
    font-size: 15px;
    color: var(--text-light); 
  }
  .owner-dropdown {
    position: relative;
  }
  .owner-display {
    cursor: pointer;
    font-weight: 500;
    font-size: 15px;
    padding: 5px 8px;
    border-radius: 6px;
    transition: background-color 0.2s;
    color: var(--text-light); 
  }
  .owner-display:hover {
    background-color: #2c3e50; 
  }
  .owner-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    z-index: 10;
    min-width: 160px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
  }
  .owner-dropdown:hover .owner-dropdown-content {
    display: block;
  }
  .owner-dropdown-content a {
    color: var(--text-dark);
    padding: 10px 16px;
    text-decoration: none;
    display: block;
    font-size: 14px;
  }
  .owner-dropdown-content a:hover {
    background-color: #f3f4f6;
  }

  /* --- Controls Section --- */
  .controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }
  .search-wrapper {
    position: relative;
    width: 100%; 
    max-width: 320px; 
  }
  .search-input {
    width: 100%;
    padding: 10px 10px 10px 40px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
  }
  .search-wrapper i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
  }
  .right-controls {
    display: flex;
    gap: 10px; 
    align-items: center;
    flex-wrap: wrap;
  }
  .duration-btn, .download-btn {
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #ccc;
    cursor: pointer;
    background-color: #fff;
    color: var(--text-dark);
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
  }
  .duration-btn:hover, .download-btn:hover {
    background-color: #f3f4f6;
  }
  .download-btn:disabled {
    color: #a5b4fc;
    cursor: not-allowed;
    background-color: #f3f4f6;
    border-color: #e5e7eb;
  }
  .create-btn {
    background-color: var(--primary-green);
    color: white;
    border: none;
    padding: 12px 20px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .create-btn:hover {
      background-color: #16a34a;
  }

  /* --- Filter Bar Styles --- */
  .filter-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    background-color: #f9fafb;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    width: 100%;
  }
  .left-actions, .show-options {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
  }
  .action-btn {
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      border: 1px solid #ccc;
      background-color: #fff;
      cursor: pointer;
  }
  .action-btn:disabled {
      background-color: #f3f4f6;
      color: var(--text-secondary);
      cursor: not-allowed;
  }
  .select-all-btn {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .show-options {
    font-size: 14px;
    color: var(--text-secondary);
  }
  .show-options span { font-weight: 500; }
  .show-checkbox {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
  }
  .show-dropdown {
      position: relative;
  }
  .show-dropdown .dropdown-menu.show-dropdown-content {
      display: block;
  }
  .more-dropdown-item.selected {
      font-weight: 600;
      color: var(--primary-blue);
  }
  .more-dropdown-item .fa-check {
      visibility: hidden;
  }
  .more-dropdown-item.selected .fa-check {
      visibility: visible;
  }

  /* --- Table Styles --- */
  .table-wrapper {
    width: 100%;
    overflow-x: auto;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background-color: white; 
  }
  th, td {
    padding: 16px;
    text-align: center;
    border-bottom: 1px solid var(--border-color);
    font-size: 14px;
    white-space: nowrap;
  }
  th {
    background-color: #f9fafb;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    font-size: 12px;
  }
  th.align-left, td.align-left {
    text-align: left;
  }
  td.assessment-name-cell {
    position: relative;
    padding-right: 40px; 
    white-space: normal;
  }
  .assessment-name-content {
      display: flex;
      align-items: center;
      gap: 10px;
  }
  .assessment-link {
      font-weight: 600;
      color: var(--primary-blue);
      text-decoration: none;
  }
  .assessment-link:hover { text-decoration: underline; }
  .badge {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 500;
    flex-shrink: 0;
  }
  .badge-tech { background-color: #fef3c7; color: #92400e; }
  .badge-non-tech { background-color: #fee2e2; color: #991b1b; }
  .org-private-icon {
     position: absolute;
     top: 50%;
     transform: translateY(-50%);
     right: 15px;
     color: var(--text-secondary);
     font-size: 16px;
  }
  .settings-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
    font-size: 14px;
    color: var(--text-secondary);
    text-align: left;
    margin: 0 auto;
    width: fit-content;
  }
  .actions-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }
  .invite-more {
    font-size: 14px;
    color: var(--primary-green);
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .invite-more:hover { text-decoration: underline; }
  .settings-link {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--text-secondary);
    cursor: pointer;
  }

  /* --- Calendar & Dropdown Styles --- */
  .duration-dropdown { position: relative; }
  .duration-options { min-width: 220px; }
  .dropdown-menu.show-dropdown-content { display: block; } 
  .calendar-container {
    display: none;
    padding: 10px; 
    width: 250px; 
    border-radius: 8px;
    background-color: #fff;
    margin-top: 8px; 
  }
  .duration-options.calendar-open .calendar-container { display: block; }
  .duration-options.calendar-open .duration-option-item { display: none; }
  .calendar-tabs {
    display: flex;
    margin-bottom: 10px; 
    border-bottom: 1px solid var(--border-color);
  }
  .calendar-tab {
    flex: 1;
    text-align: center;
    padding: 8px 0; 
    cursor: pointer;
    font-weight: 500;
    color: var(--text-secondary);
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
    font-size: 13px; 
  }
  .calendar-tab.active {
    color: var(--primary-blue);
    border-color: var(--primary-blue);
  }
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px; 
  }
  .calendar-header button {
    background: none;
    border: none;
    font-size: 16px; 
    cursor: pointer;
    color: #555;
    padding: 4px; 
  }
  .calendar-header h3 {
    margin: 0;
    font-size: 14px; 
    font-weight: 600;
  }
  .calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: bold;
    color: #777;
    font-size: 12px; 
    margin-bottom: 4px; 
  }
  .calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px; 
  }
  .calendar-day {
    padding: 6px; 
    cursor: pointer;
    border-radius: 50%;
    transition: background-color 0.2s ease, color 0.2s ease;
    font-size: 13px; 
    text-align: center;
  }
  .calendar-day:hover:not(.empty):not(.selected):not(.disabled) { background-color: #eef2ff; }
  .calendar-day.selected { background-color: var(--primary-blue); color: white; font-weight: bold; }
  .calendar-day.range-selected { background-color: #dbeafe; color: #1e40af; border-radius: 0; }
  .calendar-day.selected.range-start { border-radius: 50% 0 0 50%; }
  .calendar-day.selected.range-end { border-radius: 0 50% 50% 0; }
  .calendar-day.selected.range-start.range-end { border-radius: 50%; }
  .calendar-day.disabled { color: #ccc; cursor: not-allowed; background-color: #f9fafb; }
  .calendar-footer { margin-top: 10px; font-size: 11px; color: #888; text-align: center; }

  /* --- Modal Styles --- */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background-color: rgba(17, 24, 39, 0.75);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  .modal-box {
    background-color: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: var(--shadow-xl);
    width: 100%;
    max-width: 42rem;
    transform: scale(0.95);
    transition: transform 0.2s ease-out;
  }
  .modal-overlay.visible .modal-box {
    transform: scale(1);
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }
  .modal-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-dark);
  }
  .modal-close-btn {
    color: var(--text-secondary);
    background: none;
    border: none;
    cursor: pointer;
  }
  .modal-close-btn:hover { color: var(--text-dark); }
  .modal-close-btn svg { width: 1.75rem; height: 1.75rem; }
  .modal-grid {
    display: grid;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }
  @media (min-width: 768px) {
    .modal-grid { grid-template-columns: repeat(2, 1fr); }
    .modal-box { padding: 2rem; }
  }
  .modal-option {
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    padding: 1.5rem;
    text-align: center;
    transition: box-shadow 0.2s;
    cursor: pointer;
  }
  .modal-option:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); }
  .modal-option img {
    width: 5rem;
    height: 5rem;
    margin: 0 auto 1rem auto;
    border-radius: 0.375rem;
  }
  .modal-option h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.25rem;
  }
  .modal-option p {
    font-size: 0.875rem;
    color: #4b5563;
  }
  .modal-footer {
    margin-top: 1.5rem;
    text-align: right;
  }
  .modal-footer .ok-btn {
    background-color: var(--primary-blue);
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
  }
  .modal-footer .ok-btn:hover { background-color: #2563eb; }
  .modal-box-sm { max-width: 28rem; }

  /* --- Utility Classes --- */
  .hidden { display: none !important; }
  .visible { display: flex !important; }
  .ml-1 { margin-left: 0.25rem; }
  .fa-xs { font-size: 0.75em; }

</style>
</head>

<body>

<!-- ======================= HEADER ======================= -->
<header class="site-header">
    <div class="site-header-container">
      <div class="site-header-left">
        <span class="site-header-logo">FDI</span>
        <!-- Assessment Dropdown -->
        <nav class="nav-dropdown">
          <button class="nav-dropdown-button">Assessment</button>
          <div class="dropdown-menu dropdown-menu-left dropdown-menu-md">
            <a href="#">Assessments</a>
            <div class="submenu">
              <a href="#" class="submenu-trigger">Library <span class="ml-1">â–¶</span></a>
              <div class="dropdown-menu submenu-menu">
                <a href="#">Question Library</a>
                <a href="#">Assessment Library</a>
              </div>
            </div>
            <a href="#" id="openNewAssignmentHeader">New Assignment</a>
          </div>
        </nav>
        <!-- Interview Dropdown -->
        <nav class="nav-dropdown">
          <button class="nav-dropdown-button">Interview</button>
          <div class="dropdown-menu dropdown-menu-left dropdown-menu-md">
            <a href="#">Interview</a>
            <a href="#">Coding/Interview</a>
            <a href="#">Coding</a>
          </div>
        </nav>
      </div>
      <div class="site-header-right">
        <a href="#" class="site-header-link">Candidate</a>
        <a href="#" class="site-header-link">QList</a>
        <!-- Profile Dropdown -->
        <div class="nav-dropdown">
          <div class="profile-icon" tabindex="0">S</div>
          <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg">
            <div class="profile-menu-header">
              <div class="user-name">Sri</div>
              <div class="user-detail">srharshak@nexnoratech.onmicros...</div>
              <div class="user-detail">Nexnoratech</div>
            </div>
            <a href="#"><i class="fas fa-briefcase dropdown-menu-item-icon"></i> Company Profile</a>
            <a href="#"><i class="fas fa-users dropdown-menu-item-icon"></i> Team Members</a>
            <a href="#"><i class="fas fa-envelope dropdown-menu-item-icon"></i> Email Templates</a>
            <a href="#"><i class="fas fa-question-circle dropdown-menu-item-icon"></i> Connect Question Library</a>
            <a href="#"><i class="fas fa-chart-bar dropdown-menu-item-icon"></i> Plan Usage</a>
            <a href="#"><i class="fas fa-cog dropdown-menu-item-icon"></i> Setting Options</a>
            <a href="#"><i class="fas fa-user-circle dropdown-menu-item-icon"></i> My Account</a>
            <div class="menu-divider"></div>
            <a href="#"><i class="fas fa-sign-out-alt dropdown-menu-item-icon"></i> Logout</a>
          </div>
        </div>
        <i class="fas fa-question-circle profile-help-icon" id="helpIcon"></i>
      </div>
    </div>
</header>

<!-- ======================= ASSESSMENTS CONTAINER ======================= -->
<div class="assessments-container">
  <div class="assessments-header">
    <div class="assessments-title">Assessments</div>
    <div class="owner-dropdown-wrapper">
      <label>Owner:</label>
      <div class="owner-dropdown">
        <div class="owner-display">Everyone <i class="fas fa-chevron-down fa-xs"></i></div>
        <div class="owner-dropdown-content">
          <a href="#">Me</a>
          <a href="#">Shared with Me</a>
          <a href="#">Everyone</a>
        </div>
      </div>
    </div>
  </div>
  <div class="controls">
    <!-- Search Input -->
    <div class="search-wrapper">
      <i class="fas fa-search"></i>
      <input type="text" id="searchInput" placeholder="Search assessment by name or tag" class="search-input">
    </div>
    <!-- Right-side Controls -->
    <div class="right-controls">
      <!-- Duration Dropdown & Calendar -->
      <div class="duration-dropdown nav-dropdown">
          <button id="durationDisplayBtn" class="duration-btn">
              <i class="fas fa-calendar-alt"></i>
              <span>Select duration</span>
              <i class="fas fa-chevron-down fa-xs ml-1"></i>
          </button>
          <div class="dropdown-menu duration-options">
            <a href="#" class="duration-option-item" data-duration="Last 30 days"><i class="far fa-clock"></i> Last 30 days</a>
            <a href="#" class="duration-option-item" data-duration="Last 60 days"><i class="far fa-clock"></i> Last 60 days</a>
            <a href="#" class="duration-option-item" data-duration="Last 90 days"><i class="far fa-clock"></i> Last 90 days</a>
            <a href="#" class="duration-option-item" data-duration="Date range" id="dateRangeOption"><i class="far fa-calendar-alt"></i> Date range</a>
            <div id="calendarContainer" class="calendar-container">
              <div class="calendar-tabs">
                <div class="calendar-tab active" id="startDateTab">Start Date</div>
                <div class="calendar-tab" id="endDateTab">End Date</div>
              </div>
              <div class="calendar-header">
                <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                <h3 id="currentMonthYear"></h3>
                <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
              </div>
              <div class="calendar-weekdays">
                <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
              </div>
              <div class="calendar-days" id="calendarDays"></div>
              <div class="calendar-footer">Date range can be selected for up to 3 months.</div>
            </div>
          </div>
        </div>
        <button id="downloadBtn" class="download-btn" disabled><i class="fas fa-download"></i> DOWNLOAD</button> 
      <button id="newAssessmentButton" class="create-btn">+ NEW ASSESSMENT</button>
    </div>
  </div>
</div>

<!-- ======================= FILTER BAR ======================= -->
<div class="filter-bar">
  <div class="left-actions">
    <button id="completeBtn" class="action-btn" disabled>Mark as Complete</button>
    <label class="action-btn select-all-btn">
      <input type="checkbox" id="selectAll"> Select All
    </label>
  </div>
  <div class="show-options">
    <span>Show:</span>
    <label class="show-checkbox"><input type="checkbox" id="showActive" checked> Active</label>
    <label class="show-checkbox"><input type="checkbox" id="showCompleted"> Completed</label>
    <label class="show-checkbox"><input type="checkbox" id="showDrafts"> All Drafts</label>
    <!-- Hidden checkboxes for 'More' dropdown filters -->
    <input type="checkbox" id="showInactive" class="hidden">
    <input type="checkbox" id="showUnfinished" class="hidden">
    <div class="nav-dropdown show-dropdown">
      <button class="action-btn">More <i class="fas fa-chevron-down fa-xs"></i></button>
      <div class="dropdown-menu dropdown-menu-right more-dropdown">
        <a href="#" id="filterInactive" class="more-dropdown-item"><i class="fas fa-check"></i> Inactive</a>
        <a href="#" id="filterUnfinished" class="more-dropdown-item"><i class="fas fa-check"></i> Unfinished</a>
      </div>
    </div>
  </div>
</div>

<!-- ======================= ASSESSMENTS TABLE ======================= -->
<div class="table-wrapper">
  <table id="assessmentsTable">
    <thead>
      <tr>
        <th><input type="checkbox" id="selectAllHeader"></th>
        <th class="align-left">Assessment</th>
        <th>Settings</th>
        <th>Total Candidates</th>
        <th>Invited</th>
        <th>Submitted</th>
        <th>Evaluated</th>
        <th>Shortlisted</th>
        <th>Date Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Table rows now have a data-status attribute -->
      <tr data-status="active">
        <td><input type="checkbox" class="row-checkbox"></td>
        <td class="align-left assessment-name-cell">
          <div class="assessment-name-content">
            <a href="#" class="assessment-link">JAVA</a>
            <span class="badge badge-tech">Tech</span>
          </div>
          <span class="org-private-icon" title="Organization"><i class="fas fa-building"></i></span>
        </td>
        <td>
          <div class="settings-info">
            <span><i class="fas fa-video"></i> On Proctoring</span>
            <span><i class="fas fa-list-ol"></i> 10 Questions</span>
            <span><i class="far fa-clock"></i> 55 Minutes</span>
          </div>
        </td>
        <td>2</td><td>2</td><td>0</td><td>0</td><td>0</td>
        <td data-date="2025-07-02">Jul 2, 2025</td>
        <td>
          <div class="actions-cell">
            <a href="#" class="invite-more" title="Invite More"><i class="fas fa-user-plus"></i> Invite more</a>
            <span class="settings-link"><i class="fas fa-cog"></i> Settings</span>
          </div>
        </td>
      </tr>
      <tr data-status="active">
        <td><input type="checkbox" class="row-checkbox"></td>
        <td class="align-left assessment-name-cell">
          <div class="assessment-name-content">
            <a href="#" class="assessment-link">Full Stack Developer</a>
            <span class="badge badge-tech">Tech</span>
          </div>
          <span class="org-private-icon" title="Private"><i class="fas fa-user-lock"></i></span>
        </td>
        <td>
          <div class="settings-info">
            <span><i class="fas fa-video"></i> On Proctoring</span>
            <span><i class="fas fa-list-ol"></i> 10 Questions</span>
            <span><i class="far fa-clock"></i> 45 Minutes</span>
          </div>
        </td>
        <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
        <td data-date="2025-07-01">Jul 1, 2025</td>
        <td>
           <div class="actions-cell">
            <a href="#" class="invite-more" title="Invite More"><i class="fas fa-user-plus"></i> Invite more</a>
            <span class="settings-link"><i class="fas fa-cog"></i> Settings</span>
          </div>
        </td>
      </tr>
      <!-- NEW: Example rows for new statuses -->
      <tr data-status="draft">
        <td><input type="checkbox" class="row-checkbox"></td>
        <td class="align-left assessment-name-cell">
          <div class="assessment-name-content">
            <a href="#" class="assessment-link">Python Backend (Draft)</a>
            <span class="badge badge-tech">Tech</span>
          </div>
          <span class="org-private-icon" title="Private"><i class="fas fa-user-lock"></i></span>
        </td>
        <td>
          <div class="settings-info">
            <span><i class="fas fa-video-slash"></i> Off Proctoring</span>
            <span><i class="fas fa-list-ol"></i> 5 Questions</span>
            <span><i class="far fa-clock"></i> 30 Minutes</span>
          </div>
        </td>
        <td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
        <td data-date="2025-06-28">Jun 28, 2025</td>
        <td>
           <div class="actions-cell">
            <a href="#" class="invite-more" title="Invite More"><i class="fas fa-user-plus"></i> Invite more</a>
            <span class="settings-link"><i class="fas fa-cog"></i> Settings</span>
          </div>
        </td>
      </tr>
       <tr data-status="inactive">
        <td><input type="checkbox" class="row-checkbox"></td>
        <td class="align-left assessment-name-cell">
          <div class="assessment-name-content">
            <a href="#" class="assessment-link">Old Marketing Role (Inactive)</a>
            <span class="badge badge-non-tech">Non-Tech</span>
          </div>
          <span class="org-private-icon" title="Organization"><i class="fas fa-building"></i></span>
        </td>
        <td>
          <div class="settings-info">
            <span><i class="fas fa-video-slash"></i> Off Proctoring</span>
            <span><i class="fas fa-list-ol"></i> 15 Questions</span>
            <span><i class="far fa-clock"></i> 60 Minutes</span>
          </div>
        </td>
        <td>50</td><td>50</td><td>45</td><td>40</td><td>10</td>
        <td data-date="2024-03-15">Mar 15, 2024</td>
        <td>
           <div class="actions-cell">
            <span style="color: var(--text-secondary);">Inactive</span>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
  
<!-- ======================= MODALS ======================= -->
<!-- New Assignment Modal -->
<div id="newAssignmentModal" class="modal-overlay hidden">
    <div class="modal-box">
      <div class="modal-header">
        <h2 class="modal-title">New Assignment</h2>
        <button id="closeNewAssignmentModal" class="modal-close-btn">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <div class="modal-grid">
        <div id="automaticAssign" class="modal-option">
          <img src="https://placehold.co/80x80/3B82F6/FFFFFF?text=Auto" alt="Automatic" onerror="this.onerror=null;this.src='https://placehold.co/80x80/3B82F6/FFFFFF?text=Fallback';">
          <h3>Automatic</h3>
          <p>Automatically creates assignments based on predefined rules and data.</p>
        </div>
        <div id="customAssign" class="modal-option">
          <img src="https://placehold.co/80x80/10B981/FFFFFF?text=Manual" alt="Custom" onerror="this.onerror=null;this.src='https://placehold.co/80x80/10B981/FFFFFF?text=Fallback';">
          <h3>Manual</h3>
          <p>Manually create and customize your assignment details.</p>
        </div>
      </div>
    </div>
</div>

<!-- No Data Modal -->
<div id="noDataModal" class="modal-overlay hidden">
    <div class="modal-box modal-box-sm">
      <div class="modal-header">
        <h2 class="modal-title">No Data Available</h2>
        <button id="closeNoDataModal" class="modal-close-btn">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <p>There are no assessments to download for the selected date range.</p>
      <div class="modal-footer">
        <button id="okNoDataModal" class="ok-btn">OK</button>
      </div>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="modal-overlay hidden">
    <div class="modal-box modal-box-sm">
      <div class="modal-header">
        <h2 class="modal-title">Help & Information</h2>
        <button id="closeHelpModal" class="modal-close-btn">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      <p style="margin-top: 1rem; color: var(--text-secondary);">This is a placeholder for help information. You can add details about how to use the dashboard here.</p>
      <div class="modal-footer">
        <button id="okHelpModal" class="ok-btn">OK</button>
      </div>
    </div>
</div>


<!-- ======================= JAVASCRIPT ======================= -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // --- Unified Dropdown Logic ---
    
    function closeOtherDropdowns() {
        document.querySelector('.duration-options')?.classList.remove('show-dropdown-content');
        document.querySelector('.more-dropdown')?.classList.remove('show-dropdown-content');
    }

    const allHeaderDropdowns = document.querySelectorAll('.site-header .nav-dropdown');
    allHeaderDropdowns.forEach(dropdown => {
        if (dropdown.classList.contains('duration-dropdown') || dropdown.classList.contains('show-dropdown')) {
            return;
        }
        const trigger = dropdown.querySelector('.nav-dropdown-button, .profile-icon');
        if (trigger) {
            // MODIFIED: Added check for data-ignore-hover to prevent shake
            dropdown.addEventListener('mouseenter', () => {
                if (document.body.dataset.ignoreHover) return;
                dropdown.classList.add('menu-open');
            });
            dropdown.addEventListener('mouseleave', () => {
                if (!dropdown.classList.contains('pinned-open')) {
                    dropdown.classList.remove('menu-open');
                }
            });
            trigger.addEventListener('click', (event) => {
                event.stopPropagation();
                const wasPinned = dropdown.classList.contains('pinned-open');
                allHeaderDropdowns.forEach(d => {
                    if (d !== dropdown) d.classList.remove('pinned-open', 'menu-open');
                });
                dropdown.classList.toggle('pinned-open');
                if (dropdown.classList.contains('pinned-open')) dropdown.classList.add('menu-open');
                else dropdown.classList.remove('menu-open');
            });
        }
    });


    const moreDropdownBtn = document.querySelector('.show-dropdown .action-btn');
    if (moreDropdownBtn) {
        moreDropdownBtn.addEventListener('click', function(event) {
            event.stopPropagation();
            const menu = this.nextElementSibling;
            const wasOpen = menu.classList.contains('show-dropdown-content');
            allHeaderDropdowns.forEach(d => d.classList.remove('menu-open', 'pinned-open'));
            document.querySelector('.duration-options')?.classList.remove('show-dropdown-content');
            if (!wasOpen && menu) menu.classList.add('show-dropdown-content');
            else if (menu) menu.classList.remove('show-dropdown-content');
        });
    }
    
    // MODIFIED: Global click listener to prevent shake
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.nav-dropdown, .show-dropdown')) {
             // Set a flag to temporarily disable hover-to-open, preventing the shake
             document.body.dataset.ignoreHover = 'true';
             
             allHeaderDropdowns.forEach(d => d.classList.remove('menu-open', 'pinned-open'));
             closeOtherDropdowns();

             // Remove the flag after a short delay
             setTimeout(() => {
                delete document.body.dataset.ignoreHover;
             }, 200);
        }
    });
    
    // --- Modal Logic ---
    const newAssignmentModal = document.getElementById("newAssignmentModal");
    const noDataModal = document.getElementById('noDataModal');
    const helpModal = document.getElementById('helpModal');

    function openModal(modal) { if(modal) { modal.classList.remove('hidden'); modal.classList.add('visible'); } }
    function closeModal(modal) { if(modal) { modal.classList.add('hidden'); modal.classList.remove('visible'); } }

    document.getElementById("openNewAssignmentHeader").addEventListener("click", (e) => { e.preventDefault(); openModal(newAssignmentModal); });
    document.getElementById("newAssessmentButton").addEventListener("click", () => openModal(newAssignmentModal));
    document.getElementById("closeNewAssignmentModal").addEventListener("click", () => closeModal(newAssignmentModal));

    const closeNoDataModalBtn = document.getElementById('closeNoDataModal');
    const okNoDataModalBtn = document.getElementById('okNoDataModal');
    if(closeNoDataModalBtn) closeNoDataModalBtn.addEventListener('click', () => closeModal(noDataModal));
    if(okNoDataModalBtn) okNoDataModalBtn.addEventListener('click', () => closeModal(noDataModal));

    const helpIcon = document.getElementById('helpIcon');
    const closeHelpModalBtn = document.getElementById('closeHelpModal');
    const okHelpModalBtn = document.getElementById('okHelpModal');
    if(helpIcon) helpIcon.addEventListener('click', () => openModal(helpModal));
    if(closeHelpModalBtn) closeHelpModalBtn.addEventListener('click', () => closeModal(helpModal));
    if(okHelpModalBtn) okHelpModalBtn.addEventListener('click', () => closeModal(helpModal));


    [newAssignmentModal, noDataModal, helpModal].forEach(modal => {
        if(modal) modal.addEventListener('click', function(event) { if (event.target === this) closeModal(this); });
    });

    // --- Main Content Script (Table, Filters, Calendar) ---
    const completeBtn = document.getElementById("completeBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const rowCheckboxes = document.querySelectorAll(".row-checkbox");
    const selectAll = document.getElementById("selectAll");
    const selectAllHeader = document.getElementById("selectAllHeader");
    const durationDisplayBtn = document.getElementById("durationDisplayBtn");
    const durationOptionItems = document.querySelectorAll('.duration-option-item');
    const durationOptionsDropdown = document.querySelector('.duration-options');
    const currentMonthYear = document.getElementById("currentMonthYear");
    const prevMonthBtn = document.getElementById("prevMonth");
    const nextMonthBtn = document.getElementById("nextMonth");
    const calendarDays = document.getElementById("calendarDays");
    const searchInput = document.getElementById('searchInput');

    const showActiveFilter = document.getElementById('showActive');
    const showCompletedFilter = document.getElementById('showCompleted');
    const showDraftsFilter = document.getElementById('showDrafts');
    const showInactiveFilter = document.getElementById('showInactive');
    const showUnfinishedFilter = document.getElementById('showUnfinished');

    let currentDate = new Date();
    let selectedStartDate = null;
    let selectedEndDate = null;
    let isSelectingStartDate = true; 

    function updateButtonState() {
      const anyChecked = Array.from(rowCheckboxes).some(cb => cb.checked);
      if (completeBtn) completeBtn.disabled = !anyChecked;
    }

    function renderCalendar() {
      if (!calendarDays) return;
      calendarDays.innerHTML = '';
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      currentMonthYear.textContent = `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;
      const firstDayOfMonth = new Date(year, month, 1);
      const lastDayOfMonth = new Date(year, month + 1, 0);
      const daysInMonth = lastDayOfMonth.getDate();
      const firstDayOfWeek = firstDayOfMonth.getDay();
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      for (let i = 0; i < firstDayOfWeek; i++) calendarDays.insertAdjacentHTML('beforeend', '<div class="calendar-day"></div>');
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('calendar-day');
        dayElement.textContent = day;
        const currentDayDate = new Date(year, month, day);
        currentDayDate.setHours(0, 0, 0, 0); 
        dayElement.dataset.date = currentDayDate.toISOString();

        if (currentDayDate > today || (!isSelectingStartDate && selectedStartDate && currentDayDate < selectedStartDate)) {
            dayElement.classList.add('disabled');
        }
        if (selectedStartDate && currentDayDate.getTime() === selectedStartDate.getTime()) {
          dayElement.classList.add('selected', 'range-start');
        }
        if (selectedEndDate && currentDayDate.getTime() === selectedEndDate.getTime()) {
          dayElement.classList.add('selected', 'range-end');
        }
        if (selectedStartDate && selectedEndDate && currentDayDate > selectedStartDate && currentDayDate < selectedEndDate) {
          dayElement.classList.add('range-selected');
        }
        if (selectedStartDate && selectedEndDate && selectedStartDate.getTime() === selectedEndDate.getTime()){
            if (dayElement.classList.contains('range-start')) dayElement.classList.add('range-end');
        }
        dayElement.addEventListener('click', (event) => {
            event.stopPropagation(); 
            if (!dayElement.classList.contains('disabled')) handleDateClick(currentDayDate);
        });
        calendarDays.appendChild(dayElement);
      }
    }

    function handleDateClick(clickedDate) {
        clickedDate.setHours(0, 0, 0, 0);
        if (isSelectingStartDate) {
            selectedStartDate = clickedDate;
            selectedEndDate = null; 
            isSelectingStartDate = false; 
            if(downloadBtn) downloadBtn.disabled = true;
        } else { 
            selectedEndDate = clickedDate;
            if (selectedStartDate && selectedStartDate > selectedEndDate) {
                [selectedStartDate, selectedEndDate] = [selectedEndDate, selectedStartDate];
            }
            const diffTime = Math.abs(selectedEndDate - selectedStartDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays > 90) {
                openModal(noDataModal);
                selectedStartDate = null; 
                selectedEndDate = null;
                if(downloadBtn) downloadBtn.disabled = true;
            } else {
                if(downloadBtn) downloadBtn.disabled = false;
                if(durationOptionsDropdown) durationOptionsDropdown.classList.remove('show-dropdown-content');
            }
            isSelectingStartDate = true;
        }
        updateDurationDisplay();
        renderCalendar(); 
        applyFilters();
    }

    function updateDurationDisplay(presetText = null) {
        if(!durationDisplayBtn) return;
        const displaySpan = durationDisplayBtn.querySelector('span');
        let displayDateText = presetText || 'Select duration';
        if (!presetText && selectedStartDate && selectedEndDate) {
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            displayDateText = `${selectedStartDate.toLocaleDateString('en-US', options)} - ${selectedEndDate.toLocaleDateString('en-US', options)}`;
        }
        displaySpan.textContent = displayDateText;
    }
    
    if(prevMonthBtn) prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
    if(nextMonthBtn) nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });

    const handleSelectAll = (masterCheckbox, slaveCheckboxes) => {
        slaveCheckboxes.forEach(cb => cb.checked = masterCheckbox.checked);
        updateButtonState();
    };
    if(selectAll) selectAll.addEventListener("change", () => handleSelectAll(selectAll, rowCheckboxes));
    if(selectAllHeader) selectAllHeader.addEventListener("change", () => handleSelectAll(selectAllHeader, rowCheckboxes));
    rowCheckboxes.forEach(cb => cb.addEventListener("change", () => {
        updateButtonState();
        if (!cb.checked) {
            if(selectAll) selectAll.checked = false;
            if(selectAllHeader) selectAllHeader.checked = false;
        }
    }));
  
    durationOptionItems.forEach(item => {
      item.addEventListener('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        const selectedDurationText = item.getAttribute('data-duration');
        if (item.id === 'dateRangeOption') {
          if(durationOptionsDropdown) durationOptionsDropdown.classList.add('calendar-open');
          if(downloadBtn) downloadBtn.disabled = true;
          selectedStartDate = null;
          selectedEndDate = null;
          isSelectingStartDate = true;
          renderCalendar();
        } else {
          if(durationOptionsDropdown) durationOptionsDropdown.classList.remove('calendar-open'); 
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          selectedEndDate = today;
          selectedStartDate = new Date(today);
          if (selectedDurationText === 'Last 30 days') selectedStartDate.setDate(today.getDate() - 29);
          if (selectedDurationText === 'Last 60 days') selectedStartDate.setDate(today.getDate() - 59);
          if (selectedDurationText === 'Last 90 days') selectedStartDate.setDate(today.getDate() - 89);
          
          if(downloadBtn) downloadBtn.disabled = false; 
          if(durationOptionsDropdown) durationOptionsDropdown.classList.remove('show-dropdown-content');
          updateDurationDisplay(selectedDurationText);
        }
        applyFilters();
      });
    });

    if (durationDisplayBtn) {
        durationDisplayBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            const dropdown = document.querySelector('.duration-options');
            const wasOpen = dropdown.classList.contains('show-dropdown-content');
            allHeaderDropdowns.forEach(d => d.classList.remove('menu-open', 'pinned-open'));
            document.querySelector('.more-dropdown')?.classList.remove('show-dropdown-content');
            if (!wasOpen) {
                dropdown.classList.remove('calendar-open');
                dropdown.classList.add('show-dropdown-content');
            } else {
                 dropdown.classList.remove('show-dropdown-content');
            }
        });
    }

    function applyFilters() {
        const rows = document.querySelectorAll('#assessmentsTable tbody tr');
        const searchTerm = searchInput.value.toLowerCase();
        
        const showFilters = {
            active: showActiveFilter.checked,
            completed: showCompletedFilter.checked,
            draft: showDraftsFilter.checked,
            inactive: showInactiveFilter.checked,
            unfinished: showUnfinishedFilter.checked
        };

        rows.forEach(row => {
            const status = row.dataset.status || 'active';
            let isStatusMatch = showFilters[status] || false;

            const dateCell = row.querySelector('td[data-date]');
            let isDateMatch = true;
            if (dateCell) {
                const rowDate = new Date(dateCell.dataset.date);
                rowDate.setHours(0, 0, 0, 0);
                if (selectedStartDate && selectedEndDate) {
                    if (!(rowDate >= selectedStartDate && rowDate <= selectedEndDate)) isDateMatch = false;
                }
            }
            
            let isSearchMatch = true;
            if (searchTerm) {
                const assessmentName = row.querySelector('.assessment-link')?.textContent.toLowerCase() || '';
                if (!assessmentName.includes(searchTerm)) isSearchMatch = false;
            }
            
            row.style.display = isStatusMatch && isDateMatch && isSearchMatch ? '' : 'none';
        });
    }

    if (completeBtn) {
        completeBtn.addEventListener('click', () => {
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            checkedBoxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                if (row) {
                    row.dataset.status = 'completed';
                    const actionsCell = row.querySelector('.actions-cell');
                    if (actionsCell) {
                        actionsCell.innerHTML = `<span style="color: var(--primary-green); font-weight: 500;">Completed</span>`;
                    }
                    checkbox.checked = false;
                }
            });
            if(selectAll) selectAll.checked = false;
            if(selectAllHeader) selectAllHeader.checked = false;
            applyFilters();
            updateButtonState();
        });
    }

    function setupMoreFilter(linkId, checkboxId) {
        const link = document.getElementById(linkId);
        const checkbox = document.getElementById(checkboxId);
        if (link && checkbox) {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation(); 
                checkbox.checked = !checkbox.checked; 
                link.classList.toggle('selected', checkbox.checked); 
                applyFilters(); 
            });
        }
    }
    setupMoreFilter('filterInactive', 'showInactive');
    setupMoreFilter('filterUnfinished', 'showUnfinished');


    [showActiveFilter, showCompletedFilter, showDraftsFilter].forEach(filter => {
        if (filter) filter.addEventListener('change', applyFilters);
    });

    function downloadTableAsExcel() {
        const table = document.getElementById('assessmentsTable');
        if (!table) return;
        const rows = Array.from(table.querySelectorAll('tbody tr')).filter(row => row.style.display !== 'none');
        if (rows.length === 0) { openModal(noDataModal); return; }
        const headers = Array.from(table.querySelectorAll('thead th')).slice(1).map(th => `"${th.textContent.trim()}"`);
        const csvRows = [headers.join(',')];
        rows.forEach(row => {
            const rowData = Array.from(row.querySelectorAll('td')).slice(1).map(td => {
                let text = '';
                if (td.querySelector('.settings-info')) {
                    text = Array.from(td.querySelectorAll('.settings-info span')).map(s => s.textContent.trim().replace(/\s\s+/g, ' ')).join('; ');
                } else {
                    text = td.textContent.trim().replace(/\s\s+/g, ' ');
                }
                return `"${text.replace(/"/g, '""')}"`;
            });
            csvRows.push(rowData.join(','));
        });
        const csvContent = csvRows.join('\n');
        const blob = new Blob([csvContent], { type: 'application/vnd.ms-excel;charset=utf-8;' });
        const link = document.createElement("a");
        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "assessments_report.xls");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    if(downloadBtn) downloadBtn.addEventListener('click', () => { if (!downloadBtn.disabled) downloadTableAsExcel(); });
    if (searchInput) searchInput.addEventListener('keyup', applyFilters);
    
    // Initial setup
    updateButtonState();
    if(downloadBtn) downloadBtn.disabled = true;
    applyFilters();
  });
</script>

</body>
</html>
